<div class="col-md-2"></div>
<div class="col-md-8 card">
    <div class="header">
        <h4 class="title">Add Book</h4>
    </div>
    <div class="content">
        <form>
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label>Book Name</label>
                        <input required id="bookname" type="text" class="form-control" placeholder="e.g. Fantasy">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <label>Description</label>
                        <input required id="description" type="text" class="form-control" placeholder="e.g. Fiction">
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="form-group">
                        <label>Image</label>
                        <input id="file" type="file" class="form-control" placeholder="e.g. Fiction">
                    </div>
                </div>
            </div>

            <div class="row pull-right">
                <button class="btn btn-warning btn-fill" onclick="ulist('/admin-books')" value="Back"></button>
                <button type="submit" class="btn btn-info btn-fill" onclick="ulist('/admin-books')">
                    Submit
                </button>

            </div>

            <div class="clearfix"></div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('input#file').on('change', function () {
            console.log(this);

            var reader = new FileReader();
            reader.onload = function (e) {
                console.log(reader.result + '->' + typeof reader.result);
                var thisImage = reader.result;
                localStorage.setItem("imgData", thisImage);
            };
            reader.readAsDataURL(this.files[0]);
        });


        // process the form
        $('form').submit(function (event) {

            const bookname = $('#bookname').val();
            const description = $('#description').val();
            const formData = JSON.stringify({
                "bookname": bookname,
                "description": description,
                "image": localStorage.getItem("imgData"),
            });

            console.log(formData);


            // process the form
            $.ajax({
                type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
                url: '/book', // the url where we want to POST
                data: formData, // our data object
                contentType: 'application/json', // what type of data do we expect back from the server
                dataType: 'json', // what type of data do we expect back from the server

            })
            // using the done promise callback
                .done(function (data) {

                    // log data to the console so we can see
                    console.log(data);

                    // here we will handle errors and validation messages
                });

            // stop the form from submitting the normal way and refreshing the page
            event.preventDefault();
        });

    });
</script>